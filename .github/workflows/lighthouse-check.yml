name: Lighthouse Tests
on:
  push
  workflow_dispatch:
    inputs:
      deployPrimeUrl:
        description: Origin to test, e.g. https://deploy-preview-750--mesheryio-preview.netlify.app
        required: true
      branch:
        description: Branch being run on
        required: false
      issueNumber:
        description: issue or pull request number being run for
        required: false
      netlifyBuildContext:
        description: "The Netlify build context: https://docs.netlify.com/configure-builds/file-based-configuration/#deploy-contexts"
        required: false
      deployUrl:
        description: The deploy url generated by netlify
        required: false
      url:
        description: The url generated by netlify
        required: false

jobs:

  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Lighthouse CI Action
        id: lighthouse
        uses: treosh/lighthouse-ci-action@v9
        with:
          configPath: ./.github/workflows/lighthouserc.yml
          uploadArtifacts: true # save results as an action artifacts
          temporaryPublicStorage: true
          urls: |
            ${{ github.event.inputs.deployPrimeUrl }}
            ${{ steps.urls.outputs.urls }}